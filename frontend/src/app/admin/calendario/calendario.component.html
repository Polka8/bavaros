<div class="calendar-container">
  <div class="header">
    <div class="left-section">
      <h2>CALENDARIO PRENOTAZIONI</h2>
      <div class="date-navigation">
        <button mat-icon-button (click)="navigatePeriod(-1)">
          <mat-icon>chevron_left</mat-icon>
        </button>

        <div class="current-date" (click)="showDatePicker = true">
          {{ viewDate | date:'EEEE d MMMM y' | uppercase }}
        </div>

        <button mat-icon-button (click)="navigatePeriod(1)">
          <mat-icon>chevron_right</mat-icon>
        </button>

        <mat-form-field *ngIf="showDatePicker">
          <input matInput
                 [matDatepicker]="datePicker"
                 [(ngModel)]="viewDate"
                 (dateChange)="onDateSelected($event.value)">
          <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
          <mat-datepicker #datePicker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>

    <div class="right-section">
      <button mat-raised-button color="primary" (click)="goToToday()">
        OGGI
      </button>

      <div class="view-selector">
        <button mat-button
                *ngFor="let view of calendarViews"
                [class.active]="view === view"
                (click)="setView(view)">
          {{ view | uppercase }}
        </button>
      </div>
    </div>
  </div>

  <div class="calendar-body">
    <div [ngSwitch]="view">
      <div *ngSwitchCase="CalendarView.Month" class="month-view">
        <div class="days-header">
          <div *ngFor="let day of weekDays" class="day-header">{{ day }}</div>
        </div>
        <div class="weeks-container">
          <div *ngFor="let week of daysInMonth" class="week-row">
            <div *ngFor="let day of week"
                 class="day-cell"
                 [class.current-month]="isSameMonth(day, viewDate)"
                 [class.today]="isToday(day)">
              <div class="day-number" (click)="viewDay(day)">{{ day | date:'d' }}</div>
              <div class="events">
                <div *ngFor="let event of getEventsForDay(day)"
                     class="event-dot"
                     [style.backgroundColor]="event.color.primary"
                     [matTooltip]="getTooltipText(event)">
                  <div class="event-details">
                    <h4>{{ event.meta.nome }} {{ event.meta.cognome }}</h4>
                    <p>Posti: {{ event.meta.posti }}</p>
                    <p *ngIf="event.meta.menu?.length">Menu: {{ event.meta.menu.join(', ') }}</p>
                    <p *ngIf="event.meta.note">Note: {{ event.meta.note }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngSwitchCase="CalendarView.Week" class="week-view">
        <div class="week-range-header">{{ weekRange }}</div>
        <div class="days-grid">
          <div *ngFor="let day of daysInWeek"
               class="day-cell"
               [class.current-week]="isSameWeek(day, viewDate)"
               [class.today]="isToday(day)">
            <div class="day-number" (click)="viewDay(day)">
              {{ day | date:'d' }}
            </div>
            <div class="events">
              <div *ngFor="let event of getEventsForDay(day)"
                   class="event-dot"
                   [style.backgroundColor]="event.color.primary"
                   [matTooltip]="getTooltipText(event)">
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngSwitchCase="CalendarView.Day" class="day-view">
        <div class="day-view-container">
          <div class="time-slots-column">
            <div *ngFor="let slot of timeSlots" class="time-slot">{{ slot.label }}</div>
          </div>
          <div class="events-area">
            <div *ngFor="let event of getEventsForDayTimeline()"
                 class="day-event"
                 [style.top.px]="calculateTopPosition(event) + 'px'"
                 [style.backgroundColor]="event.color.primary"
                 [style.left.px]="(event.meta.overlapOffset || 5) + 'px'"
                 [style.width.px]="'10px'"
                 [style.height.px]="'20px'"
                 [matTooltip]="getTooltipText(event)">
              <div class="event-content">
                {{ event.title }}
              </div>
              <div class="event-details">
                <h4>{{ event.meta.nome }} {{ event.meta.cognome }}</h4>
                <p>Posti: {{ event.meta.posti }}</p>
                <p *ngIf="event.meta.menu?.length">Menu: {{ event.meta.menu.join(', ') }}</p>
                <p *ngIf="event.meta.note">Note: {{ event.meta.note }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>